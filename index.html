<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>AI Analyst: CS2 Market</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {margin:0; padding:0; font-family:sans-serif; background:#f5f5f5; color:#222;}
  h1,h2 {color:#facc00; text-align:center;}
  .container {padding:15px;}
  .buttons, .items {display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-top:20px;}
  button {padding:12px 20px; border:none; border-radius:10px; font-weight:bold; cursor:pointer; background:#fff; color:#222; border:2px solid #facc00; transition:.2s;}
  button:hover {background:#facc00; color:#fff;}
  .item {background:#fff; border:2px solid #facc00; border-radius:12px; width:150px; text-align:center; cursor:pointer; transition:.2s;}
  .item:hover {transform:scale(1.05);}
  .item img {width:80px; height:80px; object-fit:contain; margin-bottom:5px;}
  .trend-up {color:#0a0; font-weight:bold;}
  .trend-down {color:#a00; font-weight:bold;}
  .backBtn {margin-top:15px; padding:10px 20px; border-radius:8px; border:2px solid #facc00; background:#fff; cursor:pointer; font-weight:bold;}
  .backBtn:hover {background:#facc00; color:#fff;}
  #priceChart {max-width:100%; margin-top:15px;}
  label {margin-right:5px; font-weight:bold;}
  select {padding:5px 10px; border-radius:5px; border:1px solid #facc00;}
</style>
</head>
<body>

<!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
<div class="container" id="screen1">
  <h1>üíé AI Analyst: CS2 Market</h1>
  <div class="buttons">
    <button data-cat="knives">–ù–æ–∂–∏</button>
    <button data-cat="weapons">–û—Ä—É–∂–∏–µ</button>
    <button data-cat="agents">–ê–≥–µ–Ω—Ç—ã</button>
  </div>
</div>

<!-- –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ -->
<div class="container" id="screen2" style="display:none;">
  <h2 id="categoryTitle"></h2>
  <div class="items" id="itemsContainer"></div>
  <button class="backBtn" id="backBtn">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>

<!-- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–µ–¥–º–µ—Ç–∞ -->
<div class="container" id="screen3" style="display:none;">
  <h2 id="itemName"></h2>
  <img id="itemImage" src="" alt="" style="width:150px;height:150px;object-fit:contain;margin-bottom:10px;">
  <div>
    <label for="conditionSelect">–°–æ—Å—Ç–æ—è–Ω–∏–µ:</label>
    <select id="conditionSelect"></select>
  </div>
  <div>–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: $<span id="itemPrice"></span></div>
  <div>–ü—Ä–æ–≥–Ω–æ–∑: <span id="itemTrend"></span></div>
  <div>–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–∫—É–ø–∫–∏: <span id="itemProfit"></span>%</div>
  <canvas id="priceChart"></canvas>
  <button class="backBtn" id="itemBackBtn">‚¨Ö –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</button>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.ready();

let currentCategory = null;
let chart = null;

const screen1 = document.getElementById('screen1');
const screen2 = document.getElementById('screen2');
const screen3 = document.getElementById('screen3');

const categoryTitle = document.getElementById('categoryTitle');
const itemsContainer = document.getElementById('itemsContainer');

const itemName = document.getElementById('itemName');
const itemImage = document.getElementById('itemImage');
const itemPrice = document.getElementById('itemPrice');
const itemTrend = document.getElementById('itemTrend');
const itemProfit = document.getElementById('itemProfit');
const priceChart = document.getElementById('priceChart');
const conditionSelect = document.getElementById('conditionSelect');

// –ö–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥
document.getElementById('backBtn').onclick = ()=>{ screen2.style.display="none"; screen1.style.display="block"; };
document.getElementById('itemBackBtn').onclick = ()=>{ screen3.style.display="none"; screen2.style.display="block"; if(chart){ chart.destroy(); chart=null; } };

// –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ API –±–æ—Ç–∞
function fetchItems(category){
  currentCategory = category;
  fetch(`https://your-bot-server.com/api/items?category=${category}`)
    .then(res => res.json())
    .then(data => { renderItems(data); })
    .catch(err => console.error(err));
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
function renderItems(items){
  itemsContainer.innerHTML="";
  items.forEach(skin=>{
    const div = document.createElement('div');
    div.className="item";
    div.innerHTML = `<img src="${skin.image}" alt="${skin.name}"><div>${skin.name}</div>`;
    div.onclick = ()=>{
      screen2.style.display="none";
      screen3.style.display="block";
      showSkinDetail(skin);
    };
    itemsContainer.appendChild(div);
  });
}

// –ü–æ–∫–∞–∑ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∫–∏–Ω–∞ —Å –≤—ã–±–æ—Ä–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è
function showSkinDetail(skin){
  itemName.textContent = skin.name;
  itemImage.src = skin.image;

  // –ó–∞–ø–æ–ª–Ω—è–µ–º select –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
  conditionSelect.innerHTML = "";
  skin.variants.forEach((v,i)=>{
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = v.condition;
    conditionSelect.appendChild(opt);
  });

  updateSkinVariant(skin,0);

  conditionSelect.onchange = ()=>{
    const idx = conditionSelect.value;
    updateSkinVariant(skin, idx);
  };
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
function updateSkinVariant(skin, idx){
  const v = skin.variants[idx];
  itemPrice.textContent = v.price;
  itemTrend.textContent = v.trend==='up'?"üî∫ –†–æ—Å—Ç":"üîª –ü–∞–¥–µ–Ω–∏–µ";
  itemTrend.className = v.trend==='up'?'trend-up':'trend-down';
  itemProfit.textContent = v.profit;

  // –≥—Ä–∞—Ñ–∏–∫ –∏—Å—Ç–æ—Ä–∏–∏ —Ü–µ–Ω
  const labels = v.history.map((_,i)=>`T-${v.history.length-i}`);
  const dataPoints = v.history;
  if(chart){ chart.destroy(); chart=null; }
  chart = new Chart(priceChart,{
    type:'line',
    data:{
      labels: labels,
      datasets:[{
        label:'–¶–µ–Ω–∞ ($)',
        data: dataPoints,
        borderColor:'#facc00',
        backgroundColor:'rgba(250,204,0,0.2)',
        tension:0.2
      }]
    },
    options:{ responsive:true, plugins:{legend:{display:false}} }
  });
}

// –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
screen1.querySelectorAll('button').forEach(btn=>{
  btn.onclick = ()=>{
    currentCategory = btn.dataset.cat;
    categoryTitle.textContent = currentCategory==="knives"?"–ù–æ–∂–∏":currentCategory==="weapons"?"–û—Ä—É–∂–∏–µ":"–ê–≥–µ–Ω—Ç—ã";
    screen1.style.display="none";
    screen2.style.display="block";
    fetchItems(currentCategory);
  };
});

// –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
setInterval(()=>{ if(currentCategory){ fetchItems(currentCategory); } }, 30000);
</script>
</body>
</html>
